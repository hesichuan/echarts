import{T as X,X as K,O as J,M as Y,d as Q,F as W,V as ee,S as te,a as oe,P as se,C as ae,b as ne,c as re,e as D,I as M,f as O,g as L,h as ie,i as ce}from"./ol-c5086ad1.js";import{a as le}from"./axios-c24e582b.js";import{r as A,_ as ue}from"./index-94eb563f.js";import{q as de}from"./qs-f71fb591.js";import{r as u,w as pe,d as me,b as _e,o as fe,x as w,y as E,A as c,O as ve,J as y,G as ge,P as he,K as we,L as Ee}from"./@vue-c25b4755.js";const k="/cnpec/assets/marker-default-6bdf8c2a.png",ye="/cnpec/assets/default-device-9568472a.png",C={base_url:{base:"",dev:"",pro:"",test:""},result_code:"0000",request_timeout:6e4,default_headers:"application/json;charset=UTF-8"},R=u("/"),{base_url:be}=C,Pe=be[""];pe(()=>A.currentRoute.value,e=>{R.value=e==null?void 0:e.path});const x=le.create({baseURL:Pe,timeout:C.request_timeout});x.interceptors.request.use(e=>{if(e.method==="post"&&e.headers["Content-Type"]==="application/x-www-form-urlencoded"&&(e.data=de.stringify(e.data)),e.headers.Token="67F4C4DF712F41EB31288EC6BDCD606D",e.method==="get"&&e.params){let m=e.url;m+="?";const _=Object.keys(e.params);for(const r of _)e.params[r]!==void 0&&e.params[r]!==null&&(m+=`${r}=${encodeURIComponent(e.params[r])}&`);m=m.substring(0,m.length-1),e.params={},e.url=m}return e},e=>{console.log(e),Promise.reject(e)});x.interceptors.response.use(async e=>{if(e.data.status==="SUCCEED")return e.data;if(e.data.errorCode==="100")R.value!=="/"&&A.push("/");else return e.config.url==="/china_geo.json"?e.data:(console.log("拦截器返回错误：",e),Promise.reject((e==null?void 0:e.data)||"response-error"))},e=>(console.log("err-----"+e),console.log(e.errorMessage||e.message),Promise.reject(e)));const{default_headers:Ie}=C,b=e=>{const{url:m,method:_,params:r,data:v,headersType:I,responseType:g}=e;return x({url:m,method:_,params:r,data:v,responseType:g,headers:{"Content-Type":I||Ie}})},P={get:e=>b({method:"get",...e}),post:e=>b({method:"post",...e}),delete:e=>b({method:"delete",...e}),put:e=>b({method:"put",...e})},Te=e=>P.post({url:"/customer/device/deviceLocation",data:e}),$e=e=>P.get({url:"/customer/device/kanban/getDevice",params:e}),He=()=>P.get({url:"/customer/device/kanban/get"}),ze=()=>P.get({url:"/customer/device/kanban/leaseDevice"}),Se=e=>(we("data-v-f3c5bf19"),e=e(),Ee(),e),De={class:"map-container"},Le=Se(()=>c("div",{id:"map"},null,-1)),Ve={class:"container"},Ce={class:"model-list-ul"},xe={class:"header"},Me={class:"img-box"},Oe=["src"],ke={class:"base-info"},V=23,Ae=me({__name:"DeviceMap",setup(e){console.log("VITE_ENV",{VITE_API_BASEPATH:"",VITE_BASE_PATH:"/",VITE_PUBLIC_PATH:"/cnpec/",VITE_DROP_DEBUGGER:"true",VITE_DROP_CONSOLE:"true",VITE_SOURCEMAP:"false",VITE_APP_MAP_TILE:"true",VITE_OUT_DIR:"cnpec",VITE_APP_TITLE:"设备共享平台",VITE_USER_NODE_ENV:"production",BASE_URL:"/cnpec/",MODE:"pro",DEV:!1,PROD:!0,SSR:!1});const _=u({}),r=u({});u(!1),u([]),u([]),u([]);const v=u([]);let I=_e({keyword:"",organId:"",brand:"",projectName:"",projectId:""});const g=u(null),N=u(null);u("1");let l={};const j=`${window.location.protocol}//${window.location.host}`,B=new X({visible:!0,source:new K({visible:!0,url:`${j}/A4Service/TileService.ashx?c={x}&r={y}&l={z}&token=84265148-19bb-4b6b-a2d0-923738b4ebbf&type=IMGMIX`})});function F(o){_.value={...o},console.log("deviceInfo",o);const t={organName:"所属单位：",projectName:"项目名称：",tsLon:"经度：",tsLat:"纬度：",pstnTime:"位置时间：",egnState:"发动机状态：",fuel:"当天油耗（L）：",totalFuel:"累计油耗（L）：",runHours:"当天运行小时数：",trunHours:"累计工作小时：",devSerial:"设备机号或识别码："},a={},n=document.createElement("ul");n.className="model-list-ul";for(const p in t)if(o[p]){const s=t[p];let i=o[p];s=="发动机状态："&&(i==1?i="开":i="关"),a[s]=i;const h=document.createElement("li");h.innerHTML=`${s}${i}`,n.appendChild(h)}return r.value={base:{...a},other:{mainImg:o.mainImg||""}},console.log("popupData",r.value),n}let d=null;function U(o){let t=l.forEachFeatureAtPixel(o.pixel,function(a,n){return a});if(t)if(t.getProperties().features){let a=t.getProperties().features;if(t.getProperties().features.length==1){let n=a[0].values_,p=o.coordinate;if(a[0].values_){let s=n.deviceInfo;F(s)}d.setPosition(p),l.addOverlay(d)}else d.setPosition(void 0),l.getView().getZoom()<V&&l.getView().animate({center:t.getGeometry().getCoordinates(),zoom:l.getView().getZoom()+1})}else d.setPosition(void 0);else console.log("非坐标点"),d.setPosition(void 0)}const $=()=>{l=new Y({controls:Q().extend([new W]),layers:[B],target:"map",view:new ee({center:[107.73851,34.98333],zoom:3,maxZoom:V,projection:"EPSG:4326",constrainResolution:!0,smoothResolutionConstraint:!1})});var o=new te({units:"metric"});l.addControl(o),l.on("singleclick",t=>{U(t)})},H=()=>{var o=document.getElementById("popup-closer");return d.setPosition(void 0),o.blur(),!1};var T=[],f,S;const z=o=>{T=[];let t,a;for(let n of o)t=[n.tsLon,n.tsLat],a=new oe({geometry:new se(t)}),a.setProperties({deviceInfo:n}),T.push(a);f=new ae({distance:50,minDistance:10,source:new ne({features:T})}),S=new re({source:f,zIndex:1,style:function(n){const p=n.get("features").length,s=p;if(p>1){var i=["204,235,197","168,221,181","123,204,196","78,179,211","43,140,190"];i[0],s>=0&&s<10?i[0]:s>=10&&s<100?i[1]:s>=100&&s<1e3?i[2]:s>=1e3&&s<1e4?i[3]:s>=1e4&&i[4];let h=Math.round(12+Math.pow(s,1/5)*10);return l.getView().getZoom()>=V?new D({image:new M({src:k,width:25,height:34}),text:new O({font:"15px sans-serif",text:p.toString(),fill:new L({color:"#fff"})})}):new D({image:new ie({radius:h/2,stroke:new ce({color:"#fff"}),fill:new L({color:"rgba(0,0,255,0.5)"})}),text:new O({font:"15px sans-serif",text:p.toString(),fill:new L({color:"#fff"})})})}else return new D({image:new M({src:k,width:25,height:34})})}}),l.addLayer(S)};function G(){if(console.log("clusterSource",f),d&&d.setPosition(void 0),f){var o=f.getSource().getFeatures();o.length!=0&&(f.getSource().clear(),l.removeLayer(S))}}fe(()=>{d=new J({element:g.value,autoPan:!0,offset:[-50,0],autoPanAnimation:{duration:250},stopEvent:!1}),d.setPosition(void 0),$(),G(),Z(I)});const Z=async o=>{try{const t=await Te(o);v.value=(t==null?void 0:t.data)||[],z(v.value)}catch(t){console.log("获取出错",t)}},q=o=>{const t=o.srcElement;t.src=ye};return(o,t)=>(w(),E("div",De,[Le,c("div",{id:"popup",class:"ol-popup",ref_key:"popupContainer",ref:g},[c("div",Ve,[c("div",null,[c("a",{href:"#",id:"popup-closer",class:"ol-popup-closer",onClick:H})]),c("div",{id:"popup-content",ref_key:"popupContent",ref:N},[c("div",Ce,[c("div",xe,[c("div",Me,[r.value&&r.value.other?(w(),E("img",{key:0,src:r.value.other.mainImg,onError:t[0]||(t[0]=a=>q(a))},null,40,Oe)):ve("",!0)]),c("div",ke,[c("h1",null,y(_.value.deviceName),1),c("small",null,y(_.value.brandName),1)])]),(w(!0),E(ge,null,he(r.value.base,(a,n)=>(w(),E("div",{key:n},y(n)+y(a),1))),128))])],512)])],512)]))}});const Re=ue(Ae,[["__scopeId","data-v-f3c5bf19"]]),Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{Re as D,ze as a,He as b,Ge as c,$e as g};
